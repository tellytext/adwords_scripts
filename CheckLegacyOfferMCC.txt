/********
*
* Check For Legacy Offer
* Version: 1.0
* Date: 22/11/2017
* Updated: 22/11/2017
* Author: Luke Anderson 
* On behalf of bet365.com.
*
********/

function main() {
  MccApp.accounts().withLimit(10).executeInParallel("checkAds", "");
}


function checkAds() {
  
  
  var RECIPIENTS = ("luke.anderson@bet365.com");
//  var TABLE_HEADERS = ["Account Name", "Campaign Name", "AdGroup Name", "Advert ID", "Ad Policy Approval Status", "Ad Approval Status", "Ad Enabled"];
//  
//  var tableRowArr = [];
//  var tableArr = [];
//  var htmlArr = [];
//  
//  var disapprovedAdsCount = 0;
  
  var adSelector = AdWordsApp.ads()
  .withCondition("Description1 CONTAINS '£' OR Headline CONTAINS '£' OR Description2 CONTAINS '£'");
  //.withCondition("CampaignStatus = ENABLED AND AdGroupStatus = ENABLED");  
  
  var adIter = adSelector.get();
  Logger.log("%s, %s", adIter.totalNumEntities(), AdWordsApp.currentAccount().getName());
  
  
  
  return;
  
  while (adIter.hasNext()) {
    var ad = adIter.next();
    
    if (ad.isEnabled()) {
      var accountName = AdWordsApp.currentAccount().getName();
      var campaignName = ad.getCampaign().getName();
      var adGroupName = ad.getAdGroup().getName();
      var advertID = ad.getId().toString();
      var adPolicyApprovalStatus = ad.getPolicyApprovalStatus();
      var approvalStatus = ad.getApprovalStatus();
      var advertStatus = ad.isEnabled().toString().toUpperCase();
       
      tableRowArr = [accountName, campaignName, adGroupName, advertID, adPolicyApprovalStatus, approvalStatus, advertStatus];
      tableArr.push('<tr class="tableRowBold">');
      tableArr.push('<td>'+tableRowArr.join('</td><td>')+'</td>');
      tableArr.push('</tr>');
      
      disapprovedAdsCount++;
    }
  }
  
  if(disapprovedAdsCount < 1) {
    return;
  }
  
  htmlArr.push('<html><head><style>',
            '.tableRowBold {font-weight: normal; font: 10pt arial; padding: 3px 3px 3px 3px; background-color: #fffff; border: 1px solid black}',
            '.tableColor {font: 10pt arial; padding: 3px 3px 3px 3px; background-color: #fffff; border: 1px solid black}',
            'th {font: 12pt arial; text-align: left; border: 1px solid black; background-color: #ddd; padding: 2px 2px 2px 2px}',
            'td {text-align: left; border: 1px solid black}',
            'span {font: 14pt arial;}',
            'p {font: 10pt arial;}',
            '</style></head>',
            '<body>',
            '<table><tr><th>', TABLE_HEADERS.join('</th><th>'), tableArr.join(''), '</table>',
            '<p><STRONG>Remaining Email Quota: ', MailApp.getRemainingDailyQuota(), '</STRONG></p>',
            '</body>',
            '</html>');
  
  try {
    if (!AdWordsApp.getExecutionInfo().isPreview()) {
      MailApp.sendEmail({
        to: RECIPIENTS,
        name: 'Ad Approval Status',
        subject: accountName + ' | Ad Approval Status',
        htmlBody: htmlArr.join('\n'),
      });
    }
    Logger.log("Email Sent: " + Utilities.formatDate(new Date(), AdWordsApp.currentAccount().getTimeZone(), 'MMMM dd, yyyy HH:mm:ss Z'));
  } catch(e) {
    if (!AdWordsApp.getExecutionInfo().isPreview()) {
      MailApp.sendEmail({
        to: RECIPIENTS,
        name: 'ERROR - Ad Approval Status',
        subject: 'ERROR - ' + accountName + ' | Ad Approval Status',
        body: 'ERROR: ' + e,
      });
    }
    Logger.log("ERROR: " + e + Utilities.formatDate(new Date(), AdWordsApp.currentAccount().getTimeZone(), 'MMMM dd, yyyy HH:mm:ss Z'));
  }
}